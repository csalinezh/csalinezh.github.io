<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>微信公众号文章URL的种类与结构 | 咸湖的盐鱼</title>
  <meta name="description" content="微信公众号是微信围墙花园的一部分。外界想访问其中内容时，往往需要面对一个很长的URL——其过分的长度与不甚清晰的含义给使用者带来了不小的困扰，有时携带的跟踪参数还会给分享者带来泄露身份的风险。本文将对微信公众号文章URL的三种类型进行简单的描述，并记录相关的发现。" property="og:description">
<meta property="og:title" content="微信公众号文章URL的种类与结构">
<meta property="og:url" content="https://soaked.in/2020/08/wechat-platform-url/">
<link rel="canonical" href="https://soaked.in/2020/08/wechat-platform-url/">
<meta property="og:site_name" content="咸湖的盐鱼">

<meta property="og:type" content="article">




  <link rel="stylesheet" href="/assets/style.css">

  <link rel="icon" type="image/png" sizes="48x48" href="/assets/icons/favicon-48.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16.png">
  <link rel="icon" type="image/svg+xml" sizes="any" href="/assets/icons/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/favicon-180.png">
  

  
  

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-174944653-1', 'auto');
ga('send', 'pageview');
</script>

</head>

<body class="site-container">
<header class="site-header-wrapper">
<div id="site-header" class="content-container">
  <div class="site-title-container">
    <h1 id="site-title"><a href="/">咸湖的盐鱼</a></h1>
    <div id="site-tagline">Soaked in brackish brine.</div>
  </div>
  
  <nav id="header-menu"><ul class="horizontal-list">
    <li><a href="/archive/">归档</a></li>
    <li><a href="/about/">关于</a></li>
  </ul></nav>
</div>
</header>
<div class="main-container content-container">
<main id="main-content">
  
<div id="page-container">
<article>
  <header class="page-intro">
    <h1 id="page-title">微信公众号文章URL的种类与结构</h1>
    
    <div class="entry-meta">
    <ul class="horizontal-list">
  
    <li><svg class="icon" viewBox="0 0 448 512"><title>发布日期</title><use xlink:href="/assets/icons/sprites.svg#calendar"></use></svg><a class="meta-content" href="/2020/08/wechat-platform-url/" tabindex="-1"><time datetime="2020-08-23T00:25:00+08:00" title="2020-08-23 00:25">2020-08-23</time></a></li>
  
  
    <li><svg class="icon" viewBox="0 0 576 512"><title>分类</title><use xlink:href="/assets/icons/sprites.svg#folder"></use></svg><span class="meta-content"><a href="/category/it/">IT</a></span></li>
  
  
  
    <li><svg class="icon" viewBox="0 0 640 512"><title>标签</title><use xlink:href="/assets/icons/sprites.svg#tags"></use></svg><span class="meta-content"><a href="/tag/互联网/">互联网</a>, <a href="/tag/微信/">微信</a></span></li>
  
  
    <li><svg class="icon" viewBox="0 0 512 512"><title>更改日期</title><use xlink:href="/assets/icons/sprites.svg#history"></use></svg><time class="meta-content" datetime="2021-05-09T13:30:00+08:00" title="2021-05-09 13:30">2021-05-09</time></li>
  
</ul>

    </div>
  </header>
  <div id="markdown-content">
  <p>微信公众号是微信围墙花园的一部分。外界想访问其中内容时，往往需要面对一个很长的URL——其过分的长度与不甚清晰的含义给使用者带来了不小的困扰，有时携带的跟踪参数还会给分享者带来泄露身份的风险。本文将对微信公众号文章URL的三种类型进行简单的描述，并记录相关的发现。</p>

<p>背景部分较为琐碎，赶时间可<a href="#url-formats-overview">按此跳至正题</a>。</p>

<h2 id="background">背景</h2>

<p>微信公众平台上线于2012年8月17日，伴随着微信用户量的增长，与其余社交功能紧密整合的公众号逐渐成为不少人获取信息的主要渠道，众多新兴的“自媒体”将传统媒体打得落花流水。开设一个公众号成了接触国内各类受众的方式中最有效的一种，还在建站的恐怕只剩些老古板了。相信称微信公众号是近些年来中国大陆最主要的在线信息发布渠道都不为过，其中不乏许多仅在公众号中发表的优秀内容。然而，微信公众号对外界极为封闭，使用正常的浏览器仅能通过文章的URL访问文章页，无法了解这个公众号的其他内容。搜狗的微信搜索是它们在微信客户端外唯一公开的访问渠道，然而腾讯对它仍限制重重：可以用它查看某个公众号的简介资料，早前还会在简介页列出它最新的十篇文章，但此功能最晚在2020年初已经失效了；可以进行全局的文章搜索，但效果实在差强人意，有时换用许多关键词也只能得到充斥着垃圾内容的结果。更糟糕的是，从这里得到的文章链接一段时间后（目前为6小时）就会<a href="#sogou-temp-link">过期失效</a>。纵使<a href="https://www.v2ex.com/t/553855?p=1">不少用户</a>对微信公众号有<a href="https://www.v2ex.com/t/609985?p=1">各种怨言</a>，目前它在国内内容领域的霸主地位，似乎是不可撼动的。</p>

<p>首次接触微信公众号的时候，觉得它那时的一些特性使它有成为一个历史信息存档库的潜质：内容全都储存在腾讯自己的服务器上，服务可靠且持久，内容发布者无需承担储存过去文章的成本；文章发布后无法修改，删除重发代价较大（一般的订阅号每日只能推送一次消息），能忠实地记录文章首次发表时的模样。不过，微信平台随后进行的一些规则变动则使当时的期待有些站不住脚了。对于后一点，微信于<a href="https://mp.weixin.qq.com/s/TdNOUjkWzJYVtwZ6YOUlrA">2018年2月7日</a>上线了修改文章错别字的功能，不过这个功能还是较为“克制”的，其允许修改的字数不多（目前为20个），作用恐怕确实如<a href="https://mp.weixin.qq.com/s/19pMfMJx7uBPXP7SBrsWqA">微信团队“微信派”所说</a>，<a href="https://36kr.com/p/1722263142401">只限于修改错别字</a>了。</p>

<p>20字的变动或许已经足以让作者删去文章中存在争议的句子，可好歹文章还在。但关乎文章保存时限的前一点，根据微信公告里的说法，则是应监管方的一纸文件而不再成立了：援引网信办于2017年9月7日印发的<a href="http://www.cac.gov.cn/2017-09/07/c_1121624269.htm">《互联网用户公众账号信息服务管理规定》</a>第七条中“互联网用户公众账号信息服务提供者应当对同一主体在同一平台注册公众账号的数量合理设定上限”的规定，微信在2018年先后两次将原先企业50个、个人5个公众号的<a href="https://www.ifanr.com/minapp/1128973">限额缩至企业2个，个人1个</a>。在首次调低开设公众号限额后，我便遇到了个人运营的公众号被迁移至新“主体”，先前内容均被删除的情况（原帐号似乎是个人为了企业号的权限而向他人买来的）。此外，微信还宣布将<a href="https://tech.qq.com/a/20180317/010454.htm">自动注销210天内不活跃的非认证公众号</a>（目前个人号与企业号均可进行“微信认证”）。对于一般的免费UGC平台，只要平台还在，用户发布的内容就能一直留在网上，即是用户已经淡出，或因疾病等不可抗力无法访问网站。说实话，他们恐怕本就没打算让微信公众平台成为一个适合长期保存内容的地方，否则它就不会是个只可用自家的搜狗来搜索、对帐号的历史文章列表不提供日期选择器，仅可在微信里不停地往下翻才能列出文章的围墙花园了。</p>

<p>话说回来，国内的地方政府与传统新闻媒体网站有一个通病：更换CMS时往往会更改URL的格式，过去保存在收藏夹里的链接一夜之间就失效了；有的可能还会顺带清理早期的内容，想要寻找的旧资料在新网站里连影子都没有。此时只能在搜索引擎里换着关键词来寻找转载与快照页，或是去 <a href="https://archive.org/web/">Wayback Machine</a> 和 <a href="https://archive.is/">archive.is</a> 这类存档网站来碰运气了。相比之下，那些不会被随意清理的微信公众号发布的内容则显得可靠很多。再者，目前许多机构会将微信公众号和新浪微博作为主要的公关渠道进行运营，网站往往疏于打理、更新较缓，甚至已经荒废、连域名都已被菠菜网站抢注了，使用开放互联网中的搜索引擎根本无法及时获得信息。微信，是不得不用的。</p>

<p>然而，微信公众号文章的URL始终为人诟病。在“PC时代”，再三流的CMS系统也不至于生成形如<code class="language-plaintext highlighter-rouge">https://mp.weixin.qq.com/s?__biz=MjM5NjM4MDAxMg==&amp;mid=2655090139&amp;idx=1&amp;sn=7516984a032cb031ce73577fe0ae5366</code>这样令人凌乱的URL。可是，微信（以及不少现代社交网站与IM）会将用于跟踪用户的参数掺进本来足以定位一篇文章的URL里，并把这一长串吓人的东西藏在漂亮的消息气泡内，再贴上一张诱人的缩略图。在它们的围墙花园里，这些ugly detail都被掩盖在华丽的界面之下。但当用户想把文章分享到围墙花园之外，就不得不面对它们的底层实现——URL。在当前版本的微信中，选择“复制链接”会得到形如<code class="language-plaintext highlighter-rouge">https://mp.weixin.qq.com/s/ruYM6tbU06iI4zfeQDTuLA</code>的短链接，而如果选择“在浏览器打开”，便会在浏览器的地址栏中看到形似段首例子的长URL，并带有多项可以起跟踪作用的参数。</p>

<p>网上有一些爬取微信公众号文章的经验介绍，不过在下面的文章中，我仅将尝试介绍微信公众号文章URL的三种类型，并描述哪些参数是必须的。（其实是水平太差了，不想研究如何爬取）</p>

<h2 id="url-formats-overview">三种URL格式</h2>

<p>这里使用新华社的公众号“新华网”于北京时间2021年5月8日18:36:40发表的<a href="https://mp.weixin.qq.com/s/-rwvHhqYbKGCVFeXRNknYQ">《注意！疫苗接种第二针不能这样打！》</a>作为例子。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://mp.weixin.qq.com/s/-rwvHhqYbKGCVFeXRNknYQ
https://mp.weixin.qq.com/s?__biz=MzA4MjQxNjQzMA==&amp;mid=2768628484&amp;idx=1&amp;sn=93dcc54ce807f7793739ee2fd2377056
https://mp.weixin.qq.com/s?src=11&amp;timestamp=1620536401&amp;ver=3057&amp;signature=vCDI8FQcumnNGv4ScvFP-swQRlirdQSqTfjS8m-oFzgHMkqlNM3ljzjSevcjXLC-z-n0RzzMkNt-lwKMUaskfaqFFrpYZNq4ZCKkFFGj8L*KvH780aEUBJFvWTGmMGLC
</code></pre></div></div>

<p>为了下文叙述方便，会将以上三种URL分别称为“短链接”、“完整链接”与“搜狗临时链接”。观察上述三种URL，可以判断公众号文章链接具有的共同点是第一级路径为”s”，而其后跟随的参数则没有明确的语言含义。</p>

<p>微信公众平台使用的域名是mp.weixin.qq.com。它使用了mp这个子域名，而“微信公众平台”目前的官方英文名为”WeChat Official Accounts Platform”，即“微信官方号平台”，其中没有可以缩写出mp的单词。起初我由“公众”这个词猜测它可能指”mass platform”，不过根据下文<a href="#ref-list">“参见”</a>中列出的一些介绍微信历史的文章，微信公众平台曾被称为“媒体平台”与“官号平台”。域名中mp这个缩写是“媒体平台”(media platform)留下的，而它目前使用的英文名则是“官号平台”留下的。</p>

<p>直接访问mp.weixin.qq.com会跳转至微信公众平台管理后台的登录页，该页面内还有一些指向微信公众平台开发文档与帮助文档的链接。</p>

<h3 id="full-link">完整链接</h3>

<p>这种链接应当是最为经典的公众号文章链接了。目前版本的微信中，浏览文章时在菜单栏內选择“在浏览器打开”，便可在浏览器的地址栏内见到此种风格的URL。这也是将文章转发给好友时，气泡类型的链接实际使用的URL种类。</p>

<p>公众号文章会设置一个全局的JavaScript变量<code class="language-plaintext highlighter-rouge">msg_link</code>，它的值就是完整链接格式的文章URL。这个变量可直接在文章的HTML代码中找到。（使用时需要对其进行HTML entity decode，将&amp;amp;替换为&amp;）</p>

<p>在Android版微信中使用“在浏览器打开”会把微信Webview内使用的URL直接传给浏览器应用，这样得到的URL会比上面例子中提到的更长，其中含有不少非必要的参数，其中部分相信可用于追溯出生成这个链接的微信用户的身份。</p>

<p><code class="language-plaintext highlighter-rouge">__biz</code>，为business的缩写，对该公众号发布的所有文章均相同。参数值使用base64编码，解码后为一串数字，相信是公众号的ID。<br />
<code class="language-plaintext highlighter-rouge">mid</code>，相信指”message id”，对应到公众号后台中“素材库”里的“图文消息”，它的值对于某一个公众号似乎是自增的。如果一条群发的“图文消息”内有多篇文章，那么其中各篇文章的mid值均相同。公众号支持的消息类型可参见<a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Batch_Sends_and_Originality_Checks.html#2">微信公众平台群发接口的文档</a><br />
<code class="language-plaintext highlighter-rouge">idx</code>，指”index”，值为该篇文章在某次群发中的顺序。若只发布了一篇文章，这个值就为1。<br />
<code class="language-plaintext highlighter-rouge">sn</code>，指”signature”（下文详述），相信其格式为一个32位的16进制数，也即128位的2进制数。它应该是通过某种校验和算法生成的，而常用的128位散列算法只有MD5吧。当然，这个值是微信公众平台后端生成的，访问者只能将其原封不动地保存下来。</p>

<p>大致于2016年底某时开始，新文章的<code class="language-plaintext highlighter-rouge">msg_link</code>变量会带上<code class="language-plaintext highlighter-rouge">chksm</code>参数，显然指”checksum”。它的值为一76位的16进制数，即304位的2进制数。它可能是由多个散列值拼接而成，或是由较长的散列结果截短得到的。但实际访问时将其略去亦不会报错，且与其他几个必要的参数一样是恒定的，不知道有何作用。从链接长度方面考虑，分享链接时不妨将其略去，保留上述4个参数即可。</p>

<p>考虑到校验和常被用于确认下载到的文件内容是否与发布者的一致，我曾猜想这个值或许与修正文章错别字的功能有关，用于标记生成这个链接时文章的版本。但借用一位老友的公众号进行修改文字的实验后发现<code class="language-plaintext highlighter-rouge">chksm</code>并未改变，因此相信可以认为chksm也是文章发布后就不再变化的。</p>

<p>关于链接中的<code class="language-plaintext highlighter-rouge">sn</code>参数，一篇发布于2014年9月的文章<a href="https://mp.weixin.qq.com/s/laVLXBVG_qNWuCdoDk8AUg">《解读微信公众平台图文消息的链接组成》</a>提到，早期的公众号文章链接没有<code class="language-plaintext highlighter-rouge">sn</code>参数。从上述的规则亦可以发现，凭<code class="language-plaintext highlighter-rouge">__biz</code>, <code class="language-plaintext highlighter-rouge">mid</code>, <code class="language-plaintext highlighter-rouge">idx</code>三个参数足以定位到某篇文章，<code class="language-plaintext highlighter-rouge">sn</code>的作用似乎有些多余。这篇文章的作者认为，这么做是为了防止未经授权的用户通过修改mid的方式查看素材库内尚未发布的图文消息，而<code class="language-plaintext highlighter-rouge">sn</code>是文章推送时生成的。记忆中生成预览链接时也会得到一个此种性质的参数，不过我暂时没有条件确认。</p>

<p>值得一提的是，这篇文章提到早期<code class="language-plaintext highlighter-rouge">mid</code>, <code class="language-plaintext highlighter-rouge">idx</code>, <code class="language-plaintext highlighter-rouge">sn</code>三个参数分别会被叫做<code class="language-plaintext highlighter-rouge">appmsgid</code>, <code class="language-plaintext highlighter-rouge">itemidx</code>, <code class="language-plaintext highlighter-rouge">sign</code>，这一点亦可由其文中举出冯大晖公众号“小道消息”于2013年发布的<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODIyMTE0MA==&amp;mid=10000382&amp;idx=1">《业绩考核》</a>一文的<code class="language-plaintext highlighter-rouge">msg_link</code>得到验证：<code class="language-plaintext highlighter-rouge">https://mp.weixin.qq.com/s?__biz=MjM5ODIyMTE0MA==&amp;appmsgid=10000382&amp;itemidx=1</code>。实验确认这两种参数名可以随意替换，互为别名。这些早期的文章仅需要前三个参数即可访问，不需要也没有<code class="language-plaintext highlighter-rouge">sn</code>。</p>

<p>如果某个公众号进行了保留原始内容的“主体迁移”，迁移后的文章的这四个参数均会改变。</p>

<h2 id="short-link">短链接</h2>

<p>对于用户来说，<code class="language-plaintext highlighter-rouge">sn</code>的加入并不能带来什么好处，反倒拉长了URL，使体验恶化。这个改动保持了原有的链接结构，但着实给用户带来了一些麻烦。</p>

<p>根据一些 <a href="http://wpweixin.com/post/17424/">报</a> <a href="https://news.mydrivers.com/1/509/509217.htm">道</a> ，微信大致于2016年11月中旬启用了一种短链接——其实并不短，但相比于完整链接的长度，确实短不少。链接的值或许为某种变种的base64，其长度恒定为22个字符。其中不带有可用与追踪用户身份的参数。</p>

<p>不过，要想获得这种链接，只能使用微信客户端（手机和电脑版）内的“复制链接”功能，HTML中并无这种链接的痕迹。此外，“复制链接”似乎不是在WebView层实现的，研究这种短链接的生成应该需要对native代码进行逆向工程。个人怀疑它可能是对<code class="language-plaintext highlighter-rouge">sn</code>进行某种编码得到的，但这仅是猜想，没有依据。</p>

<p>对于早期那些没有<code class="language-plaintext highlighter-rouge">sn</code>的文章，“复制链接”的行为与在微信中直接点击文字链接打开的中“复制链接”似乎相同，无法得到这种短链接。但那些早期文章的链接本来就不算太长，无伤大雅。</p>

<p>考虑到可以由短链接得到完整链接（通过<code class="language-plaintext highlighter-rouge">msg_link</code>），且短链接在长度上显著较短，更符合一般用户对链接格式的认识（有人认为带有query string的URL较为不美观），我认为在分享微信公众号文章时应当尽量使用“复制链接”得到的这种短链接。</p>

<h2 id="sogou-temp-link">搜狗临时链接</h2>

<p>这种链接可谓是臭名昭著了。搜狗是腾讯自家的玩意儿，只有搜狗能索引微信里的文章。用户找到了搜狗的微信搜索，偶尔还得输好几个验证码，终于读到几篇文章，它们可能会被存进收藏夹或者发到其他地方。六小时后，这些好端端的页面突然就“链接过期”了。将这些链接复制到微信内打开，便能跳转到正常的文章页面。但我亦发现，将网上一些几年前的这种临时链接复制进微信，也只能得到“参数错误”，无法访问原文。或许是他们后端有调整，又或者这种链接与永久链接的对应关系仅会保留不多于半年的时间，我不得而知。</p>

<p><code class="language-plaintext highlighter-rouge">src</code>，显然指”source”。目前发现的值有3和11两种，含义未知。<br />
<code class="language-plaintext highlighter-rouge">timestamp</code>，生成这个链接时的UNIX Timestamp，在服务器返回查询结果时便已确定，即按下搜索键或翻页的时刻。<br />
<code class="language-plaintext highlighter-rouge">ver</code>，显然指”version”。可能是生成下面<code class="language-plaintext highlighter-rouge">signature</code>使用的算法版本，每个数字会使用一段时间，可能不超过一天。<br />
<code class="language-plaintext highlighter-rouge">signature</code>，某种签名。长度恒定为128个字符，其中带有星号。</p>

<p>有效期应为6小时，到期后只能通过微信客户端才能查看。</p>

<p>曾经这些页面里也有<code class="language-plaintext highlighter-rouge">msg_link</code>，可以在它还没过期时<a href="https://www.zhihu.com/question/26084813/answer/101302798">通过这个变量得到文章的正常URL</a>。然而，微信在2016年底某时将这个变量的值以及其他提到<code class="language-plaintext highlighter-rouge">sn</code>的地方都抹掉了。</p>

<p>他们这么做的主要目的或许是为了反爬吧。但这种行为实在恶心用户，把用户产生的内容当作是自家的宝贝，捂在怀里，生怕见光。</p>

<h2 id="ref-list">参见</h2>
<ul>
  <li>爱范儿 <a href="https://www.ifanr.com/1039481">不一样的微信发展简史（2011-2018）</a></li>
  <li>南华早报 <a href="https://www.scmp.com/tech/article/2159831/how-wechat-became-chinas-everyday-mobile-app">How WeChat became China’s everyday mobile app</a><br />
（阮一峰<a href="http://www.ruanyifeng.com/blog/2018/08/weixin.html">微信的历史</a>一文对其进行了概括）</li>
  <li>蚂蚁蚂蚁 <a href="http://www.woshipm.com/pd/224359.html">微信是怎样炼成的—微信产品的发展历程</a></li>
  <li>newhappy2008 <a href="https://blog.csdn.net/newhappy2008/article/details/53489239">微信公众平台的发展历史</a></li>
</ul>

  </div>
</article>
<div id="post-nav">
  
  <div id="post-nav-next" class="post-nav-item post-nav-item-inactive">|&larr;</div>
  
  
  <div id="post-nav-prev" class="post-nav-item"><a href="/2020/08/hello-world/">Hello, World! &rarr;</a></div>
  
</div>

</div>

</main>
<aside id="site-sidebar">
<section id="link-icon">
  <ul class="horizontal-list">
    <li><a href="/feed.xml" title="Atom Feed"><svg class="icon" viewBox="0 0 448 512" style="color: #ee802f;"><title>Feed Icon</title><use xlink:href="/assets/icons/sprites.svg#feed"></use></svg></a></li>
    <li><a href="https://github.com/csalinezh" title="GitHub Profile"><svg class="icon" viewBox="0 0 496 512"><title>GitHub Logo</title><use xlink:href="/assets/icons/sprites.svg#github"></use></svg></a></li>
  </ul>
</section>

<section id="recent-posts">
  <h2>Recent Posts</h2>
  <ol class="vertical-list">
  
    <li><a href="/2020/08/wechat-platform-url/">微信公众号文章URL的种类与结构</a></li>
  
    <li><a href="/2020/08/hello-world/">Hello, World!</a></li>
  
  </ol>
</section>

<section id="category-list">
  <h2>Categories</h2>
  <ul class="vertical-list">
  
    
    <li><a href="/category/随笔/">随笔</a></li>
  
    
    <li><a href="/category/it/">IT</a></li>
  
  </ul>
</section>

</aside>
</div>
<footer class="site-footer-wrapper">
  <div id="license" class="content-container">
  若无另行说明，本站内容以<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享-署名-相同方式共享 4.0 协议国际版</a>授权。
  </div>
</footer>
</body>
